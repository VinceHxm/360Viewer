<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Safari åª’ä½“æ’­æ”¾æµ‹è¯•</title>
    <style>
        :root {
          --bg: #0f1115;
          --fg: #e6e6e6;
          --muted: #9aa4b2;
          --brand: #4f8cff;
          --panel: #161922;
          --btn: #1e2430;
          --btn-hover: #2a3142;
        }
        
        * { box-sizing: border-box; }
        html, body { 
          height: 100%; 
          margin: 0; 
          padding: 0; 
          overflow-x: hidden;
        }
        body {
          background: var(--bg);
          color: var(--fg);
          font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
        }
        
        .app-header {
          display: flex;
          align-items: center;
          justify-content: space-between;
          padding: 10px 14px;
          background: var(--panel);
          border-bottom: 1px solid #202636;
        }
        
        .brand { font-weight: 700; color: var(--brand); }
        
        .test-container {
          padding: 20px;
          max-width: 800px;
          margin: 0 auto;
        }
        
        .test-section {
          background: var(--panel);
          border: 1px solid #202636;
          border-radius: 8px;
          padding: 20px;
          margin: 20px 0;
        }
        
        .test-button {
          background: var(--brand);
          color: white;
          border: none;
          padding: 10px 20px;
          border-radius: 5px;
          cursor: pointer;
          margin: 10px 5px;
        }
        
        .test-button:hover {
          background: #5a9cff;
        }
        
        .test-button:disabled {
          background: #666;
          cursor: not-allowed;
        }
        
        .device-info {
          background: rgba(0,0,0,0.8);
          padding: 15px;
          border-radius: 8px;
          font-size: 14px;
          margin-bottom: 20px;
        }
        
        .test-results {
          background: #0c0f16;
          border: 1px solid #2a3142;
          border-radius: 5px;
          padding: 15px;
          margin: 10px 0;
          font-family: monospace;
          font-size: 12px;
          max-height: 200px;
          overflow-y: auto;
        }
        
        .media-preview {
          width: 100%;
          max-width: 400px;
          margin: 10px 0;
          border: 1px solid #2a3142;
          border-radius: 5px;
        }
        
        .url-input {
          width: 100%;
          background: #0c0f16;
          color: var(--fg);
          border: 1px solid #2a3142;
          border-radius: 5px;
          padding: 10px;
          margin: 10px 0;
        }
        
        .status-indicator {
          display: inline-block;
          width: 10px;
          height: 10px;
          border-radius: 50%;
          margin-right: 5px;
        }
        
        .status-success { background: #4CAF50; }
        .status-error { background: #f44336; }
        .status-warning { background: #ff9800; }
        .status-info { background: #2196F3; }
    </style>
</head>
<body>
    <header class="app-header">
        <div class="brand">Safari åª’ä½“æ’­æ”¾æµ‹è¯•</div>
    </header>
    
    <div class="test-container">
        <div class="device-info" id="deviceInfo">
            è®¾å¤‡æ£€æµ‹ä¸­...
        </div>
        
        <div class="test-section">
            <h3>ğŸ¯ è®¾å¤‡æ£€æµ‹ç»“æœ</h3>
            <div id="deviceDetails"></div>
        </div>
        
        <div class="test-section">
            <h3>ğŸ“· å›¾ç‰‡åŠ è½½æµ‹è¯•</h3>
            <p>æµ‹è¯•Safariæµè§ˆå™¨çš„å›¾ç‰‡åŠ è½½èƒ½åŠ›</p>
            
            <input type="text" class="url-input" id="imageUrl" placeholder="è¾“å…¥å›¾ç‰‡URLï¼ˆä¾‹å¦‚ï¼šhttps://example.com/image.jpgï¼‰" value="https://picsum.photos/800/600">
            
            <div>
                <button class="test-button" onclick="testImageLoad()">æµ‹è¯•å›¾ç‰‡åŠ è½½</button>
                <button class="test-button" onclick="testLocalImage()">æµ‹è¯•æœ¬åœ°å›¾ç‰‡</button>
            </div>
            
            <div class="test-results" id="imageResults">ç­‰å¾…æµ‹è¯•...</div>
            <img id="imagePreview" class="media-preview" style="display: none;">
        </div>
        
        <div class="test-section">
            <h3>ğŸ¬ è§†é¢‘æ’­æ”¾æµ‹è¯•</h3>
            <p>æµ‹è¯•Safariæµè§ˆå™¨çš„è§†é¢‘æ’­æ”¾èƒ½åŠ›</p>
            
            <input type="text" class="url-input" id="videoUrl" placeholder="è¾“å…¥è§†é¢‘URLï¼ˆä¾‹å¦‚ï¼šhttps://example.com/video.mp4ï¼‰" value="https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/BigBuckBunny.mp4">
            
            <div>
                <button class="test-button" onclick="testVideoLoad()">æµ‹è¯•è§†é¢‘åŠ è½½</button>
                <button class="test-button" onclick="testVideoPlay()">æµ‹è¯•è§†é¢‘æ’­æ”¾</button>
                <button class="test-button" onclick="testLocalVideo()">æµ‹è¯•æœ¬åœ°è§†é¢‘</button>
            </div>
            
            <div class="test-results" id="videoResults">ç­‰å¾…æµ‹è¯•...</div>
            <video id="videoPreview" class="media-preview" controls style="display: none;"></video>
        </div>
        
        <div class="test-section">
            <h3>ğŸ”§ Safariç‰¹æ®ŠåŠŸèƒ½æµ‹è¯•</h3>
            <div>
                <button class="test-button" onclick="testWebGL()">æµ‹è¯•WebGLæ”¯æŒ</button>
                <button class="test-button" onclick="testThreeJS()">æµ‹è¯•Three.js</button>
                <button class="test-button" onclick="testCrossOrigin()">æµ‹è¯•è·¨åŸŸåŠ è½½</button>
            </div>
            
            <div class="test-results" id="featureResults">ç­‰å¾…æµ‹è¯•...</div>
        </div>
    </div>

    <script src="https://unpkg.com/three@0.160.0/build/three.min.js"></script>
    <script>
        // è®¾å¤‡æ£€æµ‹
        const isIOS = /iPhone|iPad|iPod/i.test(navigator.userAgent);
        const isSafari = /Safari/i.test(navigator.userAgent) && !/Chrome|CriOS|FxiOS/i.test(navigator.userAgent);
        const isMacOSSafari = isSafari && /Macintosh/i.test(navigator.userAgent);
        const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
        
        function updateDeviceInfo() {
            document.getElementById('deviceInfo').innerHTML = `
                <strong>è®¾å¤‡æ£€æµ‹ç»“æœï¼š</strong><br>
                è®¾å¤‡: ${isMobile ? 'ç§»åŠ¨ç«¯' : 'æ¡Œé¢ç«¯'}<br>
                iOS: ${isIOS ? 'æ˜¯' : 'å¦'}<br>
                Safari: ${isSafari ? 'æ˜¯' : 'å¦'}<br>
                macOS Safari: ${isMacOSSafari ? 'æ˜¯' : 'å¦'}<br>
                <br>
                <strong>User Agent:</strong><br>
                ${navigator.userAgent.substring(0, 100)}...
            `;
            
            document.getElementById('deviceDetails').innerHTML = `
                <div><span class="status-indicator ${isMobile ? 'status-info' : 'status-success'}"></span>è®¾å¤‡ç±»å‹: ${isMobile ? 'ç§»åŠ¨ç«¯' : 'æ¡Œé¢ç«¯'}</div>
                <div><span class="status-indicator ${isIOS ? 'status-success' : 'status-info'}"></span>iOSè®¾å¤‡: ${isIOS ? 'æ˜¯' : 'å¦'}</div>
                <div><span class="status-indicator ${isSafari ? 'status-success' : 'status-warning'}"></span>Safariæµè§ˆå™¨: ${isSafari ? 'æ˜¯' : 'å¦'}</div>
                <div><span class="status-indicator ${isMacOSSafari ? 'status-success' : 'status-info'}"></span>macOS Safari: ${isMacOSSafari ? 'æ˜¯' : 'å¦'}</div>
            `;
        }
        
        function logResult(elementId, message, type = 'info') {
            const element = document.getElementById(elementId);
            const timestamp = new Date().toLocaleTimeString();
            const statusClass = type === 'error' ? 'status-error' : 
                              type === 'success' ? 'status-success' : 
                              type === 'warning' ? 'status-warning' : 'status-info';
            
            element.innerHTML += `<div><span class="status-indicator ${statusClass}"></span>[${timestamp}] ${message}</div>`;
            element.scrollTop = element.scrollHeight;
        }
        
        function testImageLoad() {
            const url = document.getElementById('imageUrl').value;
            const results = document.getElementById('imageResults');
            const preview = document.getElementById('imagePreview');
            
            results.innerHTML = '';
            preview.style.display = 'none';
            
            logResult('imageResults', `å¼€å§‹æµ‹è¯•å›¾ç‰‡åŠ è½½: ${url}`);
            
            const img = new Image();
            
            img.onload = function() {
                logResult('imageResults', `âœ… å›¾ç‰‡åŠ è½½æˆåŠŸ! å°ºå¯¸: ${img.width}x${img.height}`, 'success');
                preview.src = url;
                preview.style.display = 'block';
            };
            
            img.onerror = function() {
                logResult('imageResults', `âŒ å›¾ç‰‡åŠ è½½å¤±è´¥: ${url}`, 'error');
                if (isSafari) {
                    logResult('imageResults', 'Safariæç¤º: æ£€æŸ¥URLæ˜¯å¦å¯è®¿é—®ï¼Œç¡®è®¤å›¾ç‰‡æ ¼å¼æ”¯æŒ', 'warning');
                }
            };
            
            // Safariç‰¹æ®Šå¤„ç†
            if (isSafari) {
                img.crossOrigin = 'anonymous';
                logResult('imageResults', 'Safariæµè§ˆå™¨: å¯ç”¨è·¨åŸŸåŠ è½½', 'info');
            }
            
            img.src = url;
        }
        
        function testVideoLoad() {
            const url = document.getElementById('videoUrl').value;
            const results = document.getElementById('videoResults');
            const preview = document.getElementById('videoPreview');
            
            results.innerHTML = '';
            preview.style.display = 'none';
            
            logResult('videoResults', `å¼€å§‹æµ‹è¯•è§†é¢‘åŠ è½½: ${url}`);
            
            const video = document.createElement('video');
            
            // Safariç‰¹æ®Šå±æ€§
            if (isSafari) {
                video.setAttribute('webkit-playsinline', 'true');
                video.setAttribute('playsinline', 'true');
                video.setAttribute('x-webkit-airplay', 'deny');
                video.setAttribute('controls', 'true');
                video.setAttribute('preload', 'metadata');
                video.crossOrigin = 'anonymous';
                logResult('videoResults', 'Safariæµè§ˆå™¨: åº”ç”¨ç‰¹æ®Šè§†é¢‘å±æ€§', 'info');
            }
            
            video.addEventListener('loadstart', () => {
                logResult('videoResults', 'è§†é¢‘å¼€å§‹åŠ è½½...', 'info');
            });
            
            video.addEventListener('loadedmetadata', () => {
                logResult('videoResults', `âœ… è§†é¢‘å…ƒæ•°æ®åŠ è½½æˆåŠŸ! å°ºå¯¸: ${video.videoWidth}x${video.videoHeight}, æ—¶é•¿: ${video.duration}ç§’`, 'success');
            });
            
            video.addEventListener('canplay', () => {
                logResult('videoResults', 'âœ… è§†é¢‘å¯ä»¥æ’­æ”¾!', 'success');
                preview.src = url;
                preview.style.display = 'block';
            });
            
            video.addEventListener('error', (e) => {
                logResult('videoResults', `âŒ è§†é¢‘åŠ è½½å¤±è´¥: ${video.error ? video.error.message : 'æœªçŸ¥é”™è¯¯'}`, 'error');
                if (isSafari) {
                    logResult('videoResults', 'Safariæç¤º: æ£€æŸ¥URLæ˜¯å¦å¯è®¿é—®ï¼Œç¡®è®¤è§†é¢‘æ ¼å¼æ”¯æŒï¼ˆæ¨èMP4ï¼‰', 'warning');
                }
            });
            
            video.src = url;
            video.load();
        }
        
        function testVideoPlay() {
            const preview = document.getElementById('videoPreview');
            if (!preview.src) {
                logResult('videoResults', 'è¯·å…ˆåŠ è½½è§†é¢‘', 'warning');
                return;
            }
            
            logResult('videoResults', 'å°è¯•æ’­æ”¾è§†é¢‘...', 'info');
            
            preview.play().then(() => {
                logResult('videoResults', 'âœ… è§†é¢‘æ’­æ”¾æˆåŠŸ!', 'success');
            }).catch((error) => {
                logResult('videoResults', `âŒ è§†é¢‘æ’­æ”¾å¤±è´¥: ${error.message}`, 'error');
                if (isSafari) {
                    logResult('videoResults', 'Safariæç¤º: å¯èƒ½éœ€è¦ç”¨æˆ·äº¤äº’æ‰èƒ½æ’­æ”¾', 'warning');
                }
            });
        }
        
        function testLocalImage() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = 'image/*';
            
            input.onchange = function(e) {
                const file = e.target.files[0];
                if (file) {
                    const url = URL.createObjectURL(file);
                    document.getElementById('imageUrl').value = url;
                    testImageLoad();
                }
            };
            
            input.click();
        }
        
        function testLocalVideo() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = 'video/*';
            
            input.onchange = function(e) {
                const file = e.target.files[0];
                if (file) {
                    const url = URL.createObjectURL(file);
                    document.getElementById('videoUrl').value = url;
                    testVideoLoad();
                }
            };
            
            input.click();
        }
        
        function testWebGL() {
            const results = document.getElementById('featureResults');
            results.innerHTML = '';
            
            logResult('featureResults', 'æµ‹è¯•WebGLæ”¯æŒ...', 'info');
            
            try {
                const canvas = document.createElement('canvas');
                const gl = canvas.getContext('webgl') || canvas.getContext('experimental-webgl');
                
                if (gl) {
                    logResult('featureResults', 'âœ… WebGLæ”¯æŒæ­£å¸¸!', 'success');
                    logResult('featureResults', `WebGLç‰ˆæœ¬: ${gl.getParameter(gl.VERSION)}`, 'info');
                    logResult('featureResults', `æ¸²æŸ“å™¨: ${gl.getParameter(gl.RENDERER)}`, 'info');
                } else {
                    logResult('featureResults', 'âŒ WebGLä¸æ”¯æŒ', 'error');
                }
            } catch (error) {
                logResult('featureResults', `âŒ WebGLæµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
            }
        }
        
        function testThreeJS() {
            const results = document.getElementById('featureResults');
            
            logResult('featureResults', 'æµ‹è¯•Three.jsæ”¯æŒ...', 'info');
            
            try {
                if (typeof THREE !== 'undefined') {
                    logResult('featureResults', `âœ… Three.jsåŠ è½½æˆåŠŸ! ç‰ˆæœ¬: ${THREE.REVISION}`, 'success');
                    
                    const scene = new THREE.Scene();
                    const camera = new THREE.PerspectiveCamera(75, 1, 0.1, 1000);
                    const renderer = new THREE.WebGLRenderer();
                    
                    logResult('featureResults', 'âœ… Three.jsåœºæ™¯åˆ›å»ºæˆåŠŸ!', 'success');
                    
                    // Safariç‰¹æ®Šæµ‹è¯•
                    if (isSafari) {
                        logResult('featureResults', 'Safariæµè§ˆå™¨: Three.jsæ¸²æŸ“å™¨ä¼˜åŒ–å·²åº”ç”¨', 'info');
                    }
                } else {
                    logResult('featureResults', 'âŒ Three.jsæœªåŠ è½½', 'error');
                }
            } catch (error) {
                logResult('featureResults', `âŒ Three.jsæµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
            }
        }
        
        function testCrossOrigin() {
            const results = document.getElementById('featureResults');
            
            logResult('featureResults', 'æµ‹è¯•è·¨åŸŸåŠ è½½æ”¯æŒ...', 'info');
            
            // æµ‹è¯•CORS
            fetch('https://httpbin.org/get', {
                mode: 'cors'
            }).then(response => {
                if (response.ok) {
                    logResult('featureResults', 'âœ… è·¨åŸŸè¯·æ±‚æ”¯æŒæ­£å¸¸!', 'success');
                } else {
                    logResult('featureResults', 'âŒ è·¨åŸŸè¯·æ±‚å¤±è´¥', 'error');
                }
            }).catch(error => {
                logResult('featureResults', `âŒ è·¨åŸŸè¯·æ±‚é”™è¯¯: ${error.message}`, 'error');
                if (isSafari) {
                    logResult('featureResults', 'Safariæç¤º: å¯èƒ½éœ€è¦æœåŠ¡å™¨æ”¯æŒCORS', 'warning');
                }
            });
        }
        
        // åˆå§‹åŒ–
        updateDeviceInfo();
        
        console.log('è®¾å¤‡æ£€æµ‹:', { isMobile, isIOS, isSafari, isMacOSSafari, userAgent: navigator.userAgent });
        
        // Safariç‰¹æ®Šåˆå§‹åŒ–
        if (isSafari) {
            logResult('featureResults', 'Safariæµè§ˆå™¨æ£€æµ‹åˆ°ï¼Œåº”ç”¨ç‰¹æ®Šä¼˜åŒ–', 'info');
        }
    </script>
</body>
</html>
