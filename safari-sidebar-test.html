<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Safari Sidebar æµ‹è¯•</title>
    <style>
        :root {
          --bg: #0f1115;
          --fg: #e6e6e6;
          --muted: #9aa4b2;
          --brand: #4f8cff;
          --panel: #161922;
          --btn: #1e2430;
          --btn-hover: #2a3142;
        }
        
        * { box-sizing: border-box; }
        html, body { 
          height: 100%; 
          margin: 0; 
          padding: 0; 
          overflow-x: hidden;
        }
        body {
          background: var(--bg);
          color: var(--fg);
          font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
        }
        
        .app-header {
          display: flex;
          align-items: center;
          justify-content: space-between;
          padding: 10px 14px;
          background: var(--panel);
          border-bottom: 1px solid #202636;
        }
        
        .brand { font-weight: 700; color: var(--brand); }
        
        .viewer {
          position: relative;
          height: calc(100vh - 60px);
          min-height: 360px;
          outline: none;
          /* Safariæµè§ˆå™¨ç‰¹æ®Šä¼˜åŒ– */
          -webkit-overflow-scrolling: touch;
          -webkit-transform: translateZ(0);
          transform: translateZ(0);
          will-change: transform;
        }
        
        .sidebar {
          position: absolute;
          right: 0;
          top: 0;
          bottom: 0;
          width: clamp(220px, 28vw, 360px);
          background: var(--panel);
          border-left: 1px solid #202636;
          display: flex;
          flex-direction: column;
          z-index: 100;
          /* Safariæµè§ˆå™¨ç‰¹æ®Šä¼˜åŒ– */
          -webkit-transform: translateZ(0);
          transform: translateZ(0);
          -webkit-backface-visibility: hidden;
          backface-visibility: hidden;
        }
        
        .sidebar__header { 
          display: flex; 
          gap: 8px; 
          padding: 8px; 
          border-bottom: 1px solid #202636; 
        }
        
        .tabs { 
          display: flex; 
          gap: 6px; 
          padding: 8px; 
          border-bottom: 1px solid #202636; 
        }
        
        .tab { 
          background: var(--btn); 
          color: var(--fg); 
          border: 1px solid #2a3142; 
          padding: 6px 10px; 
          border-radius: 6px; 
          cursor: pointer; 
        }
        
        .tab.active { background: var(--btn-hover); }
        
        .tabpanes { flex: 1; overflow: auto; }
        
        .file-list { 
          list-style: none; 
          margin: 0; 
          padding: 0; 
        }
        
        .file-list li { 
          padding: 8px 10px; 
          border-bottom: 1px solid #202636; 
          cursor: default; 
          display: flex; 
          justify-content: space-between; 
          gap: 8px; 
        }
        
        .file-list li:hover { background: #1a1f2b; }
        
        .file-list__name { 
          overflow: hidden; 
          text-overflow: ellipsis; 
          white-space: nowrap; 
        }
        
        .main-content {
          position: absolute;
          left: 0;
          top: 0;
          right: clamp(220px, 28vw, 360px);
          bottom: 0;
          background: var(--bg);
          display: flex;
          align-items: center;
          justify-content: center;
          flex-direction: column;
          padding: 20px;
        }
        
        .device-info {
          position: fixed;
          top: 10px;
          left: 10px;
          background: rgba(0,0,0,0.8);
          padding: 10px;
          border-radius: 5px;
          font-size: 12px;
          z-index: 1000;
          max-width: 300px;
        }
        
        .test-button {
          background: var(--brand);
          color: white;
          border: none;
          padding: 10px 20px;
          border-radius: 5px;
          cursor: pointer;
          margin: 10px;
        }
        
        .test-button:hover {
          background: #5a9cff;
        }
        
        /* Safariæµè§ˆå™¨ç‰¹æ®Šæ ·å¼ï¼ˆåŒ…æ‹¬iOSå’ŒmacOSï¼‰ */
        @supports (-webkit-touch-callout: none) {
          .sidebar {
            /* iOSè®¾å¤‡sidebarç‰¹æ®Šä¼˜åŒ– */
            position: absolute !important;
            display: flex !important;
            visibility: visible !important;
            opacity: 1 !important;
          }
        }
        
        /* macOS Safariç‰¹æ®Šæ ·å¼ */
        @supports (-webkit-appearance: none) {
          .sidebar {
            /* macOS Safari sidebarä¼˜åŒ– */
            position: absolute !important;
            display: flex !important;
            visibility: visible !important;
            opacity: 1 !important;
            z-index: 100 !important;
          }
        }
        
        @media (max-width: 768px) {
          .sidebar {
            width: clamp(200px, 35vw, 300px);
            z-index: 100;
            -webkit-transform: translateZ(0);
            transform: translateZ(0);
          }
          
          .main-content {
            right: clamp(200px, 35vw, 300px);
          }
        }
    </style>
</head>
<body>
    <div class="device-info" id="deviceInfo">
        è®¾å¤‡æ£€æµ‹ä¸­...
    </div>
    
    <header class="app-header">
        <div class="brand">Safari Sidebar æµ‹è¯•</div>
    </header>
    
    <main class="viewer">
        <div class="main-content">
            <h2>ğŸ¯ Safariæµè§ˆå™¨å³ä¾§è¾¹æ æµ‹è¯•</h2>
            <p>å¦‚æœæ‚¨çœ‹åˆ°å³ä¾§è¾¹æ ï¼Œè¯´æ˜ä¿®å¤æˆåŠŸï¼</p>
            <p>å¦‚æœçœ‹ä¸åˆ°ï¼Œè¯·æ£€æŸ¥æ§åˆ¶å°æ—¥å¿—ã€‚</p>
            
            <button class="test-button" onclick="testSidebar()">æµ‹è¯•Sidebar</button>
            <button class="test-button" onclick="forceShowSidebar()">å¼ºåˆ¶æ˜¾ç¤ºSidebar</button>
            <button class="test-button" onclick="checkSidebarStatus()">æ£€æŸ¥çŠ¶æ€</button>
        </div>
        
        <aside class="sidebar" id="sidebar">
            <div class="sidebar__header">
                <span>ğŸ“± å³ä¾§è¾¹æ </span>
            </div>
            <div class="tabs">
                <button class="tab active">è§†é¢‘</button>
                <button class="tab">å›¾ç‰‡</button>
            </div>
            <div class="tabpanes">
                <ul class="file-list">
                    <li><span class="file-list__name">æµ‹è¯•è§†é¢‘ 1</span></li>
                    <li><span class="file-list__name">æµ‹è¯•è§†é¢‘ 2</span></li>
                    <li><span class="file-list__name">æµ‹è¯•è§†é¢‘ 3</span></li>
                    <li><span class="file-list__name">æµ‹è¯•è§†é¢‘ 4</span></li>
                    <li><span class="file-list__name">æµ‹è¯•è§†é¢‘ 5</span></li>
                    <li><span class="file-list__name">æµ‹è¯•è§†é¢‘ 6</span></li>
                    <li><span class="file-list__name">æµ‹è¯•è§†é¢‘ 7</span></li>
                    <li><span class="file-list__name">æµ‹è¯•è§†é¢‘ 8</span></li>
                    <li><span class="file-list__name">æµ‹è¯•è§†é¢‘ 9</span></li>
                    <li><span class="file-list__name">æµ‹è¯•è§†é¢‘ 10</span></li>
                </ul>
            </div>
        </aside>
    </main>

    <script>
        // è®¾å¤‡æ£€æµ‹
        const isIOS = /iPhone|iPad|iPod/i.test(navigator.userAgent);
        const isSafari = /Safari/i.test(navigator.userAgent) && !/Chrome|CriOS|FxiOS/i.test(navigator.userAgent);
        const isMacOSSafari = isSafari && /Macintosh/i.test(navigator.userAgent);
        const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
        
        document.getElementById('deviceInfo').innerHTML = `
            <strong>è®¾å¤‡æ£€æµ‹ç»“æœï¼š</strong><br>
            è®¾å¤‡: ${isMobile ? 'ç§»åŠ¨ç«¯' : 'æ¡Œé¢ç«¯'}<br>
            iOS: ${isIOS ? 'æ˜¯' : 'å¦'}<br>
            Safari: ${isSafari ? 'æ˜¯' : 'å¦'}<br>
            macOS Safari: ${isMacOSSafari ? 'æ˜¯' : 'å¦'}<br>
            <br>
            <strong>User Agent:</strong><br>
            ${navigator.userAgent.substring(0, 80)}...
        `;
        
        console.log('è®¾å¤‡æ£€æµ‹:', { isMobile, isIOS, isSafari, isMacOSSafari, userAgent: navigator.userAgent });
        
        // Safariæµè§ˆå™¨ç‰¹æ®Šå¤„ç†
        function initSafariOptimizations() {
            console.log('åˆå§‹åŒ–Safariæµè§ˆå™¨ä¼˜åŒ–');
            
            const sidebar = document.getElementById('sidebar');
            if (sidebar) {
                // ç¡®ä¿sidebarå¯è§
                sidebar.style.display = 'flex';
                sidebar.style.visibility = 'visible';
                sidebar.style.opacity = '1';
                sidebar.style.position = 'absolute';
                sidebar.style.right = '0';
                sidebar.style.top = '0';
                sidebar.style.bottom = '0';
                sidebar.style.zIndex = '100';
                
                // å¼ºåˆ¶é‡ç»˜
                sidebar.style.transform = 'translateZ(0)';
                sidebar.style.webkitTransform = 'translateZ(0)';
                
                console.log('Sidebaræ ·å¼å·²åº”ç”¨:', {
                    display: sidebar.style.display,
                    visibility: sidebar.style.visibility,
                    opacity: sidebar.style.opacity,
                    position: sidebar.style.position,
                    width: sidebar.offsetWidth,
                    height: sidebar.offsetHeight
                });
            }
            
            // å»¶è¿Ÿæ£€æŸ¥
            setTimeout(() => {
                const sidebar = document.getElementById('sidebar');
                if (sidebar) {
                    console.log('å»¶è¿Ÿæ£€æŸ¥ - Sidebarå°ºå¯¸:', {
                        offsetWidth: sidebar.offsetWidth,
                        offsetHeight: sidebar.offsetHeight,
                        clientWidth: sidebar.clientWidth,
                        clientHeight: sidebar.clientHeight
                    });
                    
                    if (sidebar.offsetWidth === 0) {
                        console.warn('Sidebarä¸å¯è§ï¼Œå°è¯•ä¿®å¤');
                        sidebar.style.width = '250px';
                        sidebar.style.minWidth = '200px';
                    }
                }
            }, 100);
        }
        
        // æµ‹è¯•å‡½æ•°
        function testSidebar() {
            const sidebar = document.getElementById('sidebar');
            console.log('Sidebaræµ‹è¯•:', {
                element: sidebar,
                display: sidebar.style.display,
                visibility: sidebar.style.visibility,
                opacity: sidebar.style.opacity,
                position: sidebar.style.position,
                offsetWidth: sidebar.offsetWidth,
                offsetHeight: sidebar.offsetHeight,
                clientWidth: sidebar.clientWidth,
                clientHeight: sidebar.clientHeight
            });
        }
        
        function forceShowSidebar() {
            const sidebar = document.getElementById('sidebar');
            sidebar.style.display = 'flex';
            sidebar.style.visibility = 'visible';
            sidebar.style.opacity = '1';
            sidebar.style.position = 'absolute';
            sidebar.style.right = '0';
            sidebar.style.top = '0';
            sidebar.style.bottom = '0';
            sidebar.style.zIndex = '100';
            sidebar.style.width = '250px';
            console.log('å¼ºåˆ¶æ˜¾ç¤ºSidebar');
        }
        
        function checkSidebarStatus() {
            const sidebar = document.getElementById('sidebar');
            const rect = sidebar.getBoundingClientRect();
            console.log('SidebarçŠ¶æ€æ£€æŸ¥:', {
                rect: rect,
                computedStyle: window.getComputedStyle(sidebar),
                isVisible: rect.width > 0 && rect.height > 0
            });
        }
        
        // åˆå§‹åŒ–
        if (isIOS || isSafari) {
            initSafariOptimizations();
        }
        
        // çª—å£å¤§å°å˜åŒ–ç›‘å¬
        window.addEventListener('resize', () => {
            setTimeout(() => {
                const sidebar = document.getElementById('sidebar');
                if (sidebar) {
                    console.log('Resizeå - Sidebarå°ºå¯¸:', {
                        offsetWidth: sidebar.offsetWidth,
                        offsetHeight: sidebar.offsetHeight
                    });
                }
            }, 100);
        });
    </script>
</body>
</html>
